# HDFS(하둡 분산 파일 시스템)

## HDFS 파일 저장 방식
HDFS는 파일을 분산 저장하기 위해서 먼저 파일의 메타 데이터와 컨텐츠 데이터를 분리합니다. 
메타 데이터는 파일의 접근 권한, 생성일, 수정일, 네임 스페이스 등 파일에 대해 설명하는 정보들이 해당합니다. 컨텐츠 데이터는 실제 파일에 저장된 데이터를 말합니다. 
**파일의 메타데이터는 네임 노드에 저장되며 컨텐츠 데이터는 블록 단위로 쪼개져서 데이터 노드에 저장** 됩니다. 블록의 기본 크기는 128MB이며 최소 3개의 복사본을 생성하여 분산 저장합니다. 
아래 다이어 그램은 하나의 파일이 어떻게 블록 단위로 쪼개어지는 지 보여줍니다.

![image](https://github.com/user-attachments/assets/f6c343cf-ae88-448b-bcf8-ef3e495e4a6b)


## HDFS 아키텍쳐

* HDFS는 마스터(master) / 슬레이브(slave) 구조를 가진다.
* HDFS에서 마스터 역할 -> NameNode 서버 1대
* HDFS에서 슬레이브 역할 -> DataNode 서버 여러 대로 구성
* Block 구조의 파일 시스템으로, 저장하는 파일은 특정 사이즈의 Block으로 나눠져 분산된 서버에 저장되게 된다.
* 하나의 Block은 3개로 복제되며 (수정 가능), 각각 다른 HDFS의 노드에 분산 저장된다.

## HDFS 클러스터
하나의 NameNode & FileSystem을 관리
클라이언트의 접근을 통제하는 Master Server로 구성
클러스터의 각 노드들에는 DataNode가 하나씩 존재하고, 이 DataNode는 실행될 때 마다 Node의 추가되는 스토리지를 관리
HDFS는 네임스페이스를 공개해서 유저 데이터가 파일에 저장되는 것을 허용

## NameNode
HDFS의 모든 메타데이터(Block들이 저장되는 디렉토리의 이름, 파일명 등...)을 관리
클라이언트가 메타데이터를 이용하여 HDFS에 저장된 파일에 접근 가능
파일과 디렉토리의 읽기(open), 닫기(close), 이름 바꾸기(rename) 등 파일 시스템의 네임스페이스의 여러 기능을 수행하고, DataNode와 Block들의 매핑을 결정

## DataNode
주기적으로 NameNode에서 블록 리포트(노드에 저장되어 있는 블록의 정보)를 전송 -> 이를 통해 NameNode는 DataNode가 정상 동작하는지 확인
파일 시스템의 클라이언트가 요구하는 읽기(read), 쓰기(write) 기능을 담당 -> DataNode는 NameNode에서의 생성, 삭제, 복제 등과 같은 기능도 수행


## 파일 저장(Write) 플로우
![image](https://github.com/user-attachments/assets/0d8a10b2-961e-43a0-89fb-bf3d8244de27)

어플리케이션이 HDFS 클라이언트에게 파일 저장을 요청 -> HDFS 클라이언트는 NameNode에게 파일 블록들이 저장될 경로 생성을 요청 -> NameNode는 해당 파일 경로가 존재하지 않으면 경로를 새로 생성 -> 다른 클라이언트가 해당 경로를 수정하지 못하도록 Lock을 검 (보안 & 무결성 유지) -> NameNode는 클라이언트에게 해당 파일 블록들을 저장한 DataNode의 목록을 반환

클라이언트는 1번째 DataNode에게 데이터를 전송

1번째 DataNode는 데이터를 로컬에 저장한 후 -> 데이터를 2번째 DataNode로 전송

2번째 DataNode는 데이터를 로컬에 저장한 후 -> 데이터를 3번째 DataNode로 전송

(6번 포함) 로컬에 데이터를 저장하였으면 자기에게 데이터를 넘겨준 DataNode (이전의 DataNode)에게 데이터의 로컬 저장이 완료 되었음을 응답 (ACK 신호로 알려준다. -> "데이터 복제 잘 됬고 저장 잘 됬어~" 라는 의미)

1번째 DataNode는 클라이언트에게 파일 저장이 완료 되었음을 응답


## 파일 읽기(Read) 플로우

![image](https://github.com/user-attachments/assets/01fd55ac-c91a-415c-8bbc-a54fd6de010c)

어플리케이션이 클라이언트에게 파일 읽기를 요청

클라이언트는 NameNode에게 요청된 파일이 어떤 블록에 저장되어 있는지의 정보를 요청

메타데이터(디렉토리명, 파일명 등)를 통해 파일이 저장된 블록 리스트를 반환

클라이언트는 DataNode에 접근하여 블록 조회 요청

DataNode는 클라이언트에게 요청된 블록을 전송

클라이언트에서 어플리케이션에 데이터를 전달

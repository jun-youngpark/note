# 데이터베이스 동시성 제어 (Concurrency Control)

## 개념
동시성 제어는 다수의 트랜잭션이 동시에 실행될 때 데이터베이스의 일관성을 유지하기 위한 기술입니다. 트랜잭션이 동시에 처리되면 데이터의 무결성이 훼손될 수 있기 때문에, 이를 방지하기 위해 동시성 제어가 필요합니다. 동시성 제어의 목표는 여러 트랜잭션이 동시에 실행되어도 결과가 마치 순차적으로 실행된 것처럼 보이게 만드는 것입니다.

## 트랜잭션과 동시성
- **트랜잭션**은 데이터베이스에서 수행되는 하나의 작업 단위로, 여러 연산을 포함할 수 있습니다.
- **동시성**은 여러 트랜잭션이 동시에 실행되는 상태를 의미합니다. 이때, 트랜잭션 간에 자원(예: 데이터)을 공유하므로 충돌이나 오류가 발생할 수 있습니다.

## 동시성 제어의 문제점
1. **갱신 손실 (Lost Update)**: 두 트랜잭션이 같은 데이터를 동시에 수정할 때, 하나의 수정이 다른 수정에 의해 덮어쓰여지는 문제입니다.
2. **반복 불가능한 읽기 (Unrepeatable Read)**: 트랜잭션이 데이터를 읽은 후, 같은 데이터를 다시 읽었을 때 다른 값이 나오는 문제입니다.
3. **팬텀 읽기 (Phantom Read)**: 트랜잭션이 조건에 맞는 데이터 집합을 읽을 때, 다른 트랜잭션에 의해 새로운 데이터가 추가되거나 삭제되는 문제입니다.

## 동시성 제어 기법
### 1. **락 (Lock)**
- **공유 락(Shared Lock)**: 여러 트랜잭션이 데이터를 읽을 수 있게 허용하지만, 데이터를 수정할 수는 없습니다.
- **배타 락(Exclusive Lock)**: 하나의 트랜잭션만 데이터를 읽고 수정할 수 있게 허용합니다.

### 2. **낙관적 동시성 제어 (Optimistic Concurrency Control)**
- 트랜잭션이 데이터를 수정할 때 충돌이 발생할 가능성이 낮다고 가정하고, 트랜잭션이 완료되기 전에 충돌이 있는지 확인합니다.
- 충돌이 없다면 트랜잭션을 커밋하고, 충돌이 발생하면 롤백합니다.

### 3. **타임스탬프 순서 제어 (Timestamp Ordering)**
- 각 트랜잭션에 고유한 타임스탬프를 부여하여, 트랜잭션이 실행되는 순서에 따라 충돌을 해결합니다. 타임스탬프가 작은 트랜잭션이 먼저 실행되도록 합니다.

### 4. **다중 버전 동시성 제어 (Multiversion Concurrency Control, MVCC)**
- 데이터베이스는 여러 버전의 데이터를 유지하여 트랜잭션이 서로 영향을 미치지 않도록 합니다. 트랜잭션은 자신이 시작된 시점의 데이터를 읽고, 다른 트랜잭션이 데이터를 수정하더라도 영향을 받지 않습니다.

## 트랜잭션의 격리 수준 (Isolation Levels)
SQL 표준에서는 트랜잭션의 격리 수준을 다음과 같이 정의합니다:
- **READ UNCOMMITTED**: 다른 트랜잭션이 커밋하지 않은 데이터를 읽을 수 있습니다.
- **READ COMMITTED**: 다른 트랜잭션이 커밋한 데이터만 읽을 수 있습니다.
- **REPEATABLE READ**: 트랜잭션이 읽은 데이터를 다른 트랜잭션이 수정할 수 없습니다.
- **SERIALIZABLE**: 트랜잭션이 순차적으로 실행된 것처럼 보이도록 보장합니다.

## 결론
동시성 제어는 데이터베이스에서 트랜잭션 간의 충돌을 방지하고 데이터 일관성을 유지하는 핵심 기술입니다. 적절한 동시성 제어 기법을 선택하여 데이터베이스 성능을 최적화하면서도 데이터 무결성을 보장하는 것이 중요합니다.
